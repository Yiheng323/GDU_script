
ALBACORE_OUT_PATH='/home/yiheng/test/basecalled_data' # make sure the input file is only a copy
+ ALBACORE_OUT_PATH=/home/yiheng/test/basecalled_data
WORKDIR='/home/yiheng/test/workspace'
+ WORKDIR=/home/yiheng/test/workspace
NAME='Hu_FAH05731_albacore202'
+ NAME=Hu_FAH05731_albacore202
DATE='20171025'
+ DATE=20171025
BARCODE='barcode56'
+ BARCODE=barcode56

cd ${ALBACORE_OUT_PATH}
+ cd /home/yiheng/test/basecalled_data
### tar -xvf ${NAME}.tar.gz
cd ${NAME}/workspace/pass
+ cd Hu_FAH05731_albacore202/workspace/pass

### filter CDS | fastq to fasta

cat ${BARCODE}/*.fastq > ${NAME}.${BARCODE}.unlysed.fastq 
+ cat barcode56/fastq_runid_392a67b9624943ee17dea19abac7f75251551481_0.fastq barcode56/fastq_runid_45b6d8787ae35ac62ea9b83bf629a46e629e2eaf_0.fastq barcode56/fastq_runid_4ed9b6b70f5fb26cc770ca4804ceb16ca25f617f_0.fastq
gzip ${NAME}.${BARCODE}.unlysed.fastq
+ gzip Hu_FAH05731_albacore202.barcode56.unlysed.fastq
gunzip -c ${NAME}.${BARCODE}.unlysed.fastq.gz | NanoLyse | gzip > ${NAME}.${BARCODE}.fastq.gz
+ NanoLyse
+ gzip
+ gunzip -c Hu_FAH05731_albacore202.barcode56.unlysed.fastq.gz
gunzip ${NAME}.${BARCODE}.fastq.gz
+ gunzip Hu_FAH05731_albacore202.barcode56.fastq.gz

### move to the workspace folder for further manipulation
mkdir -p ${WORKDIR}
+ mkdir -p /home/yiheng/test/workspace
mv ${ALBACORE_OUT_PATH}/${NAME}/workspace/pass/${NAME}.${BARCODE}.fastq ${WORKDIR}
+ mv /home/yiheng/test/basecalled_data/Hu_FAH05731_albacore202/workspace/pass/Hu_FAH05731_albacore202.barcode56.fastq /home/yiheng/test/workspace
cd ${WORKDIR}
+ cd /home/yiheng/test/workspace

# do porechop to chop out adapter sequence

porechop -i ${WORKDIR}/${NAME}.${BARCODE}.fastq -o ${WORKDIR}/${NAME}.chopped.${BARCODE}.fastq --format fastq --middle_threshold 95
+ porechop -i /home/yiheng/test/workspace/Hu_FAH05731_albacore202.barcode56.fastq -o /home/yiheng/test/workspace/Hu_FAH05731_albacore202.chopped.barcode56.fastq --format fastq --middle_threshold 95

[1m[4mLoading reads[0m
/home/yiheng/test/workspace/Hu_FAH05731_albacore202.barcode56.fastq
6 reads loaded


[1m[4mLooking for known adapter sets[0m
0 / 6 (0.0%)6 / 6 (100.0%)6 / 6 (100.0%)
                                        Best               [0m
                                        read       Best    [0m
                                        start      read end[0m
  [4mSet                                   %ID        %ID     [0m
  [32mSQK-NSK007                                92.9       73.9[0m
  Rapid                                     33.3        0.0
  [32mSQK-MAP006                                78.6      100.0[0m
  [32mSQK-MAP006 Short                         100.0      100.0[0m
  [32mPCR adapters 1                           100.0       91.3[0m
  [32mPCR tail 1                               100.0      100.0[0m
  [32mPCR tail 2                                93.1       87.1[0m
  1D^2 part 1                               60.0       58.3
  [32m1D^2 part 2                               90.9       73.3[0m
  Barcode 1 (reverse)                       60.0       68.0
  Barcode 2 (reverse)                       63.0       62.5
  Barcode 3 (reverse)                       63.0       64.3
  Barcode 4 (reverse)                       60.0       63.0
  Barcode 5 (reverse)                       63.0       67.7
  Barcode 6 (reverse)                       70.4       66.7
  Barcode 7 (reverse)                       60.0       63.0
  Barcode 8 (reverse)                       65.5       66.7
  Barcode 9 (reverse)                       66.7       66.7
  Barcode 10 (reverse)                      64.0       63.3
  Barcode 11 (reverse)                      64.0       65.5
  Barcode 12 (reverse)                      71.4       64.0
  Barcode 1 (forward)                       64.3       76.0
  Barcode 2 (forward)                       70.4       68.0
  Barcode 3 (forward)                       63.0       63.3
  Barcode 4 (forward)                       67.9       66.7
  Barcode 5 (forward)                       72.0       65.5
  [32mBarcode 6 (forward)                       70.4       91.7[0m
  Barcode 7 (forward)                       74.1       74.1
  Barcode 8 (forward)                       60.0       62.1
  Barcode 9 (forward)                       65.5       68.0
  Barcode 10 (forward)                      65.4       66.7
  Barcode 11 (forward)                      70.4       59.4
  Barcode 12 (forward)                      16.7       61.5
  Barcode 13 (forward)                      65.5       65.5
  Barcode 14 (forward)                      60.0       61.3
  Barcode 15 (forward)                      61.5       70.8
  Barcode 16 (forward)                      62.5       63.6
  Barcode 17 (forward)                      61.8       62.5
  Barcode 18 (forward)                      24.0       63.0
  Barcode 19 (forward)                      66.7       60.7
  Barcode 20 (forward)                      64.0       69.0
  Barcode 21 (forward)                      63.0       64.0
  Barcode 22 (forward)                      63.0       68.0
  Barcode 23 (forward)                      60.0       60.0
  Barcode 24 (forward)                      63.0       66.7
  Barcode 25 (forward)                      64.0       68.0
  Barcode 26 (forward)                      66.7       66.7
  Barcode 27 (forward)                      64.0       70.8
  Barcode 28 (forward)                      67.9       62.1
  Barcode 29 (forward)                      70.4       65.4
  Barcode 30 (forward)                      68.0       64.5
  Barcode 31 (forward)                      64.3       67.9
  Barcode 32 (forward)                      60.0       66.7
  Barcode 33 (forward)                      64.0       64.0
  Barcode 34 (forward)                      64.0       71.4
  Barcode 35 (forward)                      68.0       57.7
  Barcode 36 (forward)                      62.5       42.4
  Barcode 37 (forward)                      68.0       67.9
  Barcode 38 (forward)                      58.6       67.9
  Barcode 39 (forward)                      66.7       70.8
  Barcode 40 (forward)                      70.8       62.5
  Barcode 41 (forward)                      29.2       64.5
  Barcode 42 (forward)                      64.0       66.7
  Barcode 43 (forward)                      66.7       68.0
  Barcode 44 (forward)                      40.7       56.7
  Barcode 45 (forward)                      51.9       64.0
  Barcode 46 (forward)                      66.7       65.4
  Barcode 47 (forward)                      60.0       65.5
  Barcode 48 (forward)                      67.7       60.0
  Barcode 49 (forward)                      70.8       65.4
  Barcode 50 (forward)                      69.2       64.3
  Barcode 51 (forward)                      68.0       67.9
  Barcode 52 (forward)                      65.5       69.2
  Barcode 53 (forward)                      66.7       63.3
  Barcode 54 (forward)                      64.0       65.4
  Barcode 55 (forward)                      64.3       64.3
  Barcode 56 (forward)                      66.7       70.8
  Barcode 57 (forward)                      65.4       62.5
  Barcode 58 (forward)                      69.2       68.0
  Barcode 59 (forward)                      66.7       61.3
  Barcode 60 (forward)                      60.0       66.7
  Barcode 61 (forward)                      65.5       48.1
  Barcode 62 (forward)                      54.8       64.0
  Barcode 63 (forward)                      62.5       76.9
  Barcode 64 (forward)                      58.1       64.0
  Barcode 65 (forward)                      65.5       64.3
  Barcode 66 (forward)                      69.2       71.4
  Barcode 67 (forward)                      70.4       62.1
  Barcode 68 (forward)                      64.0       65.4
  Barcode 69 (forward)                      62.1       64.3
  Barcode 70 (forward)                      69.2       64.0
  Barcode 71 (forward)                      56.2       66.7
  Barcode 72 (forward)                      67.9       67.9
  Barcode 73 (forward)                      63.3       68.0
  Barcode 74 (forward)                      62.5       66.7
  Barcode 75 (forward)                      63.3       64.3
  Barcode 76 (forward)                      65.4       66.7
  Barcode 77 (forward)                      57.1       64.5
  Barcode 78 (forward)                      60.7       65.4
  Barcode 79 (forward)                      64.5       68.0
  Barcode 80 (forward)                      63.0       65.4
  Barcode 81 (forward)                      67.9       70.0
  Barcode 82 (forward)                      65.5       70.4
  Barcode 83 (forward)                      69.2       70.4
  Barcode 84 (forward)                      55.2       68.0
  Barcode 85 (forward)                      57.6       66.7
  Barcode 86 (forward)                      25.0       63.0
  Barcode 87 (forward)                      63.3       64.3
  Barcode 88 (forward)                      65.4       64.0
  Barcode 89 (forward)                      61.5       67.9
  Barcode 90 (forward)                      54.2       65.4
  Barcode 91 (forward)                      28.6       64.0
  Barcode 92 (forward)                      68.0       69.2
  Barcode 93 (forward)                      62.5       70.4
  Barcode 94 (forward)                      60.0       65.6
  Barcode 95 (forward)                      66.7       66.7
  Barcode 96 (forward)                      58.3       65.4


[1m[4mTrimming adapters from read ends[0m
                SQK-NSK007_Y_Top: [31mAATGTACTTCGTTCAGTTACGTATTGCT[0m
             SQK-NSK007_Y_Bottom: [31mGCAATACGTAACTGAACGAAGT[0m
           SQK-MAP006_Y_Top_SK63: [31mGGTTGTTTCTGTTGGTGCTGATATTGCT[0m
        SQK-MAP006_Y_Bottom_SK64: [31mGCAATATCAGCACCAACAGAAA[0m
     SQK-MAP006_Short_Y_Top_LI32: [31mCGGCGTCTGCTTGGGTGTTTAACCT[0m
  SQK-MAP006_Short_Y_Bottom_LI33: [31mGGTTAAACACCCAAGCAGACGCCG[0m
                     PCR_1_start: [31mACTTGCCTGTCGCTCTATCTTC[0m
                       PCR_1_end: [31mGAAGATAGAGCGACAGGCAAGT[0m
                PCR_tail_1_start: [31mTTAACCTTTCTGTTGGTGCTGATATTGC[0m
                  PCR_tail_1_end: [31mGCAATATCAGCACCAACAGAAAGGTTAA[0m
                PCR_tail_2_start: [31mTTAACCTACTTGCCTGTCGCTCTATCTTC[0m
                  PCR_tail_2_end: [31mGAAGATAGAGCGACAGGCAAGTAGGTTAA[0m
                1D2_part_2_start: [31mCTTCGTTCAGTTACGTATTGCTGGCGTCTGCTT[0m
                  1D2_part_2_end: [31mCACCCAAGCAGACGCCAGCAATACGTAACT[0m
                            BC06: [31mTTCTCGCAAAGGCAGAAAGTAGTC[0m
                        BC06_rev: [31mGACTACTTTCTGCCTTTGCGAGAA[0m

0 / 6 (0.0%)6 / 6 (100.0%)6 / 6 (100.0%)

6 / 6 reads had adapters trimmed from their start (652 bp removed)
6 / 6 reads had adapters trimmed from their end (389 bp removed)


[1m[4mSplitting reads containing middle adapters[0m
0 / 6 (0.0%)6 / 6 (100.0%)6 / 6 (100.0%)

0 / 6 reads were split based on middle adapters


[1m[4mSaving trimmed reads to file[0m

Saved result to /home/yiheng/test/workspace/Hu_FAH05731_albacore202.chopped.barcode56.fastq


# convert the fastq to fasta

sed '/^@/!d;s//>/;N' ${WORKDIR}/${NAME}.chopped.${BARCODE}.fastq > ${WORKDIR}/${NAME}.chopped.${BARCODE}.fasta
+ sed '/^@/!d;s//>/;N' /home/yiheng/test/workspace/Hu_FAH05731_albacore202.chopped.barcode56.fastq

# do blastn for the fasta file

blastn -query ${NAME}.chopped.${BARCODE}.fasta -db rg -evalue 0.01 -outfmt '6 qseqid sseqid evalue bitscore length pident nident sgi sacc staxids sscinames scomnames sskingdoms' -show_gis -num_threads 12 | sort -k1,1 -k4,4nr | sort -u -k1,1 --merge > ${NAME}_${BARCODE}_chopped.fasta.${DATE}.rgblast_output
+ sort -u -k1,1 --merge
+ blastn -query Hu_FAH05731_albacore202.chopped.barcode56.fasta -db rg -evalue 0.01 -outfmt '6 qseqid sseqid evalue bitscore length pident nident sgi sacc staxids sscinames scomnames sskingdoms' -show_gis -num_threads 12
+ sort -k1,1 -k4,4nr

### supplimentray information for format6:

### qseqid means Query Seq-id
### sseqid means Subject Seq-id
### evalue means Expect value
### bitscore means Bit score
### length means Alignment length
### pident means Percentage of identical matches
### nident means Number of identical matches
### sgi means Subject GI
### sacc means Subject accession
### staxids means Subject Taxonomy ID(s), separated by a ';'
### sscinames means Subject Scientific Name(s), separated by a ';'
### scomnames means Subject Common Name(s), separated by a ';'
### sskingdoms means Subject Super Kingdom(s), separated by a ';'

# cut the seqid from rgblast_output and write it into a list for separate the fasta hit files

cut -f 1 ${NAME}_${BARCODE}_chopped.fasta.${DATE}.rgblast_output > ${NAME}.rgblast.qseqid.${BARCODE}.txt
+ cut -f 1 Hu_FAH05731_albacore202_barcode56_chopped.fasta.20171025.rgblast_output

# separate the blast hit and nohit reads from the fasta file

filterbyname.sh in=${NAME}.chopped.${BARCODE}.fasta out=${NAME}.chopped.rghityes.${BARCODE}.fasta names=${NAME}.rgblast.qseqid.${BARCODE}.txt include=t
+ filterbyname.sh in=Hu_FAH05731_albacore202.chopped.barcode56.fasta out=Hu_FAH05731_albacore202.chopped.rghityes.barcode56.fasta names=Hu_FAH05731_albacore202.rgblast.qseqid.barcode56.txt include=t
java -ea -Xmx20590m -cp /home/yiheng/anaconda3/opt/bbmap-37.52/current/ driver.FilterReadsByName in=Hu_FAH05731_albacore202.chopped.barcode56.fasta out=Hu_FAH05731_albacore202.chopped.rghityes.barcode56.fasta names=Hu_FAH05731_albacore202.rgblast.qseqid.barcode56.txt include=t
Executing driver.FilterReadsByName [in=Hu_FAH05731_albacore202.chopped.barcode56.fasta, out=Hu_FAH05731_albacore202.chopped.rghityes.barcode56.fasta, names=Hu_FAH05731_albacore202.rgblast.qseqid.barcode56.txt, include=t]

Input is being processed as unpaired
Time:               0.134 seconds.
Reads Processed:    6 	0.04k reads/sec
Bases Processed:    19300 	0.14m bases/sec
Reads Out:          6
Bases Out:          19300
filterbyname.sh in=${NAME}.chopped.${BARCODE}.fasta out=${NAME}.chopped.rghitno.${BARCODE}.fasta names=${NAME}.rgblast.qseqid.${BARCODE}.txt include=f
+ filterbyname.sh in=Hu_FAH05731_albacore202.chopped.barcode56.fasta out=Hu_FAH05731_albacore202.chopped.rghitno.barcode56.fasta names=Hu_FAH05731_albacore202.rgblast.qseqid.barcode56.txt include=f
java -ea -Xmx20590m -cp /home/yiheng/anaconda3/opt/bbmap-37.52/current/ driver.FilterReadsByName in=Hu_FAH05731_albacore202.chopped.barcode56.fasta out=Hu_FAH05731_albacore202.chopped.rghitno.barcode56.fasta names=Hu_FAH05731_albacore202.rgblast.qseqid.barcode56.txt include=f
Executing driver.FilterReadsByName [in=Hu_FAH05731_albacore202.chopped.barcode56.fasta, out=Hu_FAH05731_albacore202.chopped.rghitno.barcode56.fasta, names=Hu_FAH05731_albacore202.rgblast.qseqid.barcode56.txt, include=f]

Input is being processed as unpaired
Time:               0.077 seconds.
Reads Processed:    6 	0.08k reads/sec
Bases Processed:    19300 	0.25m bases/sec
Reads Out:          0
Bases Out:          0

# do the second blast for the rghitno fasta file

blastn -query ${NAME}.chopped.rghitno.${BARCODE}.fasta -db nt -evalue 0.01 -outfmt '6 qseqid sseqid evalue bitscore length pident nident sgi sacc staxids sscinames scomnames sskingdoms' -show_gis -num_threads 12 | sort -k1,1 -k4,4nr | sort -u -k1,1 --merge > ${NAME}_${BARCODE}_chopped.fasta.${DATE}.ntblast_output
+ sort -k1,1 -k4,4nr
+ blastn -query Hu_FAH05731_albacore202.chopped.rghitno.barcode56.fasta -db nt -evalue 0.01 -outfmt '6 qseqid sseqid evalue bitscore length pident nident sgi sacc staxids sscinames scomnames sskingdoms' -show_gis -num_threads 12
+ sort -u -k1,1 --merge
Command line argument error: Query is Empty!

# cut the seqid from the ntblast_output and write it into a list for separate the fasta hit files

cut -f 1 ${NAME}_${BARCODE}_chopped.fasta.${DATE}.ntblast_output > ${NAME}.ntblast.qseqid.${BARCODE}.txt
+ cut -f 1 Hu_FAH05731_albacore202_barcode56_chopped.fasta.20171025.ntblast_output

# separate the blast hit and nohit reads from the fasta file

filterbyname.sh in=${NAME}.chopped.rghitno.${BARCODE}.fasta out=${NAME}.chopped.rghitno.nthityes.${BARCODE}.fasta names=${NAME}.ntblast.qseqid.${BARCODE}.txt include=t
+ filterbyname.sh in=Hu_FAH05731_albacore202.chopped.rghitno.barcode56.fasta out=Hu_FAH05731_albacore202.chopped.rghitno.nthityes.barcode56.fasta names=Hu_FAH05731_albacore202.ntblast.qseqid.barcode56.txt include=t
java -ea -Xmx20590m -cp /home/yiheng/anaconda3/opt/bbmap-37.52/current/ driver.FilterReadsByName in=Hu_FAH05731_albacore202.chopped.rghitno.barcode56.fasta out=Hu_FAH05731_albacore202.chopped.rghitno.nthityes.barcode56.fasta names=Hu_FAH05731_albacore202.ntblast.qseqid.barcode56.txt include=t
Executing driver.FilterReadsByName [in=Hu_FAH05731_albacore202.chopped.rghitno.barcode56.fasta, out=Hu_FAH05731_albacore202.chopped.rghitno.nthityes.barcode56.fasta, names=Hu_FAH05731_albacore202.ntblast.qseqid.barcode56.txt, include=t]

Input is being processed as unpaired
Time:               0.079 seconds.
Reads Processed:    0 	0.00k reads/sec
Bases Processed:    0 	0.00m bases/sec
Reads Out:          0
Bases Out:          0
filterbyname.sh in=${NAME}.chopped.rghitno.${BARCODE}.fasta out=${NAME}.chopped.rghitno.nthitno.${BARCODE}.fasta names=${NAME}.ntblast.qseqid.${BARCODE}.txt include=f
+ filterbyname.sh in=Hu_FAH05731_albacore202.chopped.rghitno.barcode56.fasta out=Hu_FAH05731_albacore202.chopped.rghitno.nthitno.barcode56.fasta names=Hu_FAH05731_albacore202.ntblast.qseqid.barcode56.txt include=f
java -ea -Xmx20590m -cp /home/yiheng/anaconda3/opt/bbmap-37.52/current/ driver.FilterReadsByName in=Hu_FAH05731_albacore202.chopped.rghitno.barcode56.fasta out=Hu_FAH05731_albacore202.chopped.rghitno.nthitno.barcode56.fasta names=Hu_FAH05731_albacore202.ntblast.qseqid.barcode56.txt include=f
Executing driver.FilterReadsByName [in=Hu_FAH05731_albacore202.chopped.rghitno.barcode56.fasta, out=Hu_FAH05731_albacore202.chopped.rghitno.nthitno.barcode56.fasta, names=Hu_FAH05731_albacore202.ntblast.qseqid.barcode56.txt, include=f]

Input is being processed as unpaired
Time:               0.062 seconds.
Reads Processed:    0 	0.00k reads/sec
Bases Processed:    0 	0.00m bases/sec
Reads Out:          0
Bases Out:          0

