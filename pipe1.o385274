
BASEFOLDER='/home/yiheng/test' # make sure the input file is only a copy
+ BASEFOLDER=/home/yiheng/test
NAME='Hu_FAH05731_albacore202'
+ NAME=Hu_FAH05731_albacore202
DATE='20171025'
+ DATE=20171025
BARCODE='barcode21'
+ BARCODE=barcode21

cd ${BASEFOLDER}/basecalled_data
+ cd /home/yiheng/test/basecalled_data
### tar -xvf ${NAME}.tar.gz
cd ${NAME}/workspace
+ cd Hu_FAH05731_albacore202/workspace

### filter CDS

cat pass/${BARCODE}/*.fastq fail/${BARCODE}/*.fastq > ${NAME}.${BARCODE}.unlysed.fastq 
+ cat pass/barcode21/fastq_runid_45b6d8787ae35ac62ea9b83bf629a46e629e2eaf_0.fastq pass/barcode21/fastq_runid_4ed9b6b70f5fb26cc770ca4804ceb16ca25f617f_0.fastq pass/barcode21/fastq_runid_6139336acaf8e26df76a44a2bb375771d63aa8b5_0.fastq pass/barcode21/fastq_runid_9e74fe33208b91f1dda20a48d995283b963ea7a5_0.fastq 'fail/barcode21/*.fastq'
cat: fail/barcode21/*.fastq: No such file or directory
gzip ${NAME}.${BARCODE}.unlysed.fastq
+ gzip Hu_FAH05731_albacore202.barcode21.unlysed.fastq
gunzip -c ${NAME}.${BARCODE}.unlysed.fastq.gz | NanoLyse | gzip > ${NAME}.${BARCODE}.fastq.gz
+ NanoLyse
+ gunzip -c Hu_FAH05731_albacore202.barcode21.unlysed.fastq.gz
+ gzip
gunzip ${NAME}.${BARCODE}.fastq.gz
+ gunzip Hu_FAH05731_albacore202.barcode21.fastq.gz
gzip: Hu_FAH05731_albacore202.barcode21.fastq already exists;	not overwritten
rm ${NAME}.${BARCODE}.unlysed.fastq.gz
+ rm Hu_FAH05731_albacore202.barcode21.unlysed.fastq.gz

### move to the workspace folder for further manipulation
cd ${BASEFOLDER}
+ cd /home/yiheng/test
mkdir -p workspace/${BARCODE}
+ mkdir -p workspace/barcode21
mv ${BASEFOLDER}/basecalled_data/${NAME}/workspace/${NAME}.${BARCODE}.fastq ${BASEFOLDER}/workspace/${BARCODE}
+ mv /home/yiheng/test/basecalled_data/Hu_FAH05731_albacore202/workspace/Hu_FAH05731_albacore202.barcode21.fastq /home/yiheng/test/workspace/barcode21
cd ${BASEFOLDER}/workspace/${BARCODE}
+ cd /home/yiheng/test/workspace/barcode21

# do porechop to chop out adapter sequence

porechop -i ${BASEFOLDER}/workspace/${BARCODE}/${NAME}.${BARCODE}.fastq -o ${BASEFOLDER}/workspace/${BARCODE}/${NAME}.chopped.${BARCODE}.fastq --format fastq --middle_threshold 95
+ porechop -i /home/yiheng/test/workspace/barcode21/Hu_FAH05731_albacore202.barcode21.fastq -o /home/yiheng/test/workspace/barcode21/Hu_FAH05731_albacore202.chopped.barcode21.fastq --format fastq --middle_threshold 95

[1m[4mLoading reads[0m
/home/yiheng/test/workspace/barcode21/Hu_FAH05731_albacore202.barcode21.fastq
4 reads loaded


[1m[4mLooking for known adapter sets[0m
0 / 4 (0.0%)4 / 4 (100.0%)4 / 4 (100.0%)
                                        Best               [0m
                                        read       Best    [0m
                                        start      read end[0m
  [4mSet                                   %ID        %ID     [0m
  SQK-NSK007                                85.7       72.0
  Rapid                                     59.7        0.0
  [32mSQK-MAP006                                82.1      100.0[0m
  [32mSQK-MAP006 Short                          96.0       91.7[0m
  [32mPCR adapters 1                            90.9       81.8[0m
  [32mPCR tail 1                                96.6       96.4[0m
  PCR tail 2                                82.8       82.8
  1D^2 part 1                                7.4       64.3
  1D^2 part 2                               78.8       73.3
  Barcode 1 (reverse)                       42.3       63.0
  Barcode 2 (reverse)                       66.7       66.7
  Barcode 3 (reverse)                       61.3       37.5
  Barcode 4 (reverse)                       20.8       60.0
  Barcode 5 (reverse)                       60.0       58.1
  Barcode 6 (reverse)                       63.0       71.4
  Barcode 7 (reverse)                       60.7       63.3
  Barcode 8 (reverse)                       61.5       63.0
  Barcode 9 (reverse)                       56.2       65.5
  Barcode 10 (reverse)                      16.7       53.3
  Barcode 11 (reverse)                      69.0       65.5
  Barcode 12 (reverse)                      64.5       62.5
  Barcode 1 (forward)                       66.7       68.0
  Barcode 2 (forward)                       68.8       75.0
  Barcode 3 (forward)                       60.0       64.0
  Barcode 4 (forward)                       84.0       69.2
  Barcode 5 (forward)                       64.0       68.0
  Barcode 6 (forward)                       61.3       67.9
  Barcode 7 (forward)                       65.4       64.3
  Barcode 8 (forward)                       60.0       64.3
  Barcode 9 (forward)                       60.6       66.7
  Barcode 10 (forward)                      61.5       64.3
  Barcode 11 (forward)                      59.4       73.1
  Barcode 12 (forward)                      29.2       71.4
  Barcode 13 (forward)                      58.1       60.0
  Barcode 14 (forward)                      64.3       57.9
  Barcode 15 (forward)                      59.3       63.0
  Barcode 16 (forward)                      66.7       56.7
  Barcode 17 (forward)                      66.7       33.3
  Barcode 18 (forward)                      44.0       55.6
  Barcode 19 (forward)                      63.0       50.0
  Barcode 20 (forward)                      62.5       70.8
  Barcode 21 (forward)                      60.7       68.0
  Barcode 22 (forward)                      60.7       37.5
  Barcode 23 (forward)                      66.7       60.0
  Barcode 24 (forward)                      65.5       60.7
  Barcode 25 (forward)                      62.5       64.0
  Barcode 26 (forward)                      67.9       53.6
  Barcode 27 (forward)                      66.7       64.3
  Barcode 28 (forward)                      57.7       58.6
  Barcode 29 (forward)                      64.0       51.9
  Barcode 30 (forward)                      64.0       69.0
  Barcode 31 (forward)                      69.2       64.3
  Barcode 32 (forward)                      63.3       63.3
  Barcode 33 (forward)                      67.7       59.3
  Barcode 34 (forward)                      58.1       65.4
  Barcode 35 (forward)                      65.4       66.7
  Barcode 36 (forward)                      62.5       63.3
  Barcode 37 (forward)                      68.0       66.7
  Barcode 38 (forward)                      64.0       66.7
  Barcode 39 (forward)                      65.5       56.0
  Barcode 40 (forward)                      25.9       64.3
  Barcode 41 (forward)                      66.7       56.0
  Barcode 42 (forward)                      30.8       53.1
  Barcode 43 (forward)                      66.7       66.7
  Barcode 44 (forward)                      58.3       57.7
  Barcode 45 (forward)                      50.0       37.5
  Barcode 46 (forward)                      70.4       62.5
  Barcode 47 (forward)                      63.3       62.5
  Barcode 48 (forward)                      68.0       50.0
  Barcode 49 (forward)                      65.6       64.3
  Barcode 50 (forward)                      64.3       63.0
  Barcode 51 (forward)                      58.3       56.7
  Barcode 52 (forward)                      32.0       62.5
  Barcode 53 (forward)                      62.5       58.3
  Barcode 54 (forward)                      57.1       66.7
  Barcode 55 (forward)                      57.7       30.8
  Barcode 56 (forward)                      61.5       61.5
  Barcode 57 (forward)                      64.0       60.0
  Barcode 58 (forward)                      69.2       60.6
  Barcode 59 (forward)                      65.4       66.7
  Barcode 60 (forward)                      60.0       68.0
  Barcode 61 (forward)                      56.0       35.7
  Barcode 62 (forward)                      65.4       42.9
  Barcode 63 (forward)                      62.5       71.4
  Barcode 64 (forward)                      69.2       66.7
  Barcode 65 (forward)                      65.4       59.3
  Barcode 66 (forward)                      65.5       75.0
  Barcode 67 (forward)                      70.4       66.7
  Barcode 68 (forward)                      64.0       61.5
  Barcode 69 (forward)                      68.0       64.0
  Barcode 70 (forward)                      66.7       62.5
  Barcode 71 (forward)                      66.7       65.5
  Barcode 72 (forward)                      64.3       58.8
  Barcode 73 (forward)                      62.1       62.5
  Barcode 74 (forward)                      37.5       64.0
  Barcode 75 (forward)                      46.2       69.2
  Barcode 76 (forward)                      62.5       60.0
  Barcode 77 (forward)                      58.6       58.3
  Barcode 78 (forward)                      25.9       66.7
  Barcode 79 (forward)                      68.0       60.0
  Barcode 80 (forward)                      62.5       58.6
  Barcode 81 (forward)                      65.5       65.5
  Barcode 82 (forward)                      60.0       60.0
  Barcode 83 (forward)                      63.0       68.0
  Barcode 84 (forward)                      64.3       34.6
  Barcode 85 (forward)                      46.4       61.5
  Barcode 86 (forward)                      60.7       50.0
  Barcode 87 (forward)                      62.5       59.3
  Barcode 88 (forward)                      64.0       63.3
  Barcode 89 (forward)                      66.7       64.3
  Barcode 90 (forward)                      65.4       68.0
  Barcode 91 (forward)                      53.8       60.0
  Barcode 92 (forward)                      33.3       64.0
  Barcode 93 (forward)                      63.3       67.9
  Barcode 94 (forward)                      57.1       58.6
  Barcode 95 (forward)                      58.6       74.1
  Barcode 96 (forward)                      61.5       63.3


[1m[4mTrimming adapters from read ends[0m
           SQK-MAP006_Y_Top_SK63: [31mGGTTGTTTCTGTTGGTGCTGATATTGCT[0m
        SQK-MAP006_Y_Bottom_SK64: [31mGCAATATCAGCACCAACAGAAA[0m
     SQK-MAP006_Short_Y_Top_LI32: [31mCGGCGTCTGCTTGGGTGTTTAACCT[0m
  SQK-MAP006_Short_Y_Bottom_LI33: [31mGGTTAAACACCCAAGCAGACGCCG[0m
                     PCR_1_start: [31mACTTGCCTGTCGCTCTATCTTC[0m
                       PCR_1_end: [31mGAAGATAGAGCGACAGGCAAGT[0m
                PCR_tail_1_start: [31mTTAACCTTTCTGTTGGTGCTGATATTGC[0m
                  PCR_tail_1_end: [31mGCAATATCAGCACCAACAGAAAGGTTAA[0m

0 / 4 (0.0%)4 / 4 (100.0%)4 / 4 (100.0%)

3 / 4 reads had adapters trimmed from their start (319 bp removed)
3 / 4 reads had adapters trimmed from their end (260 bp removed)


[1m[4mSplitting reads containing middle adapters[0m
0 / 4 (0.0%)4 / 4 (100.0%)4 / 4 (100.0%)

0 / 4 reads were split based on middle adapters


[1m[4mSaving trimmed reads to file[0m

Saved result to /home/yiheng/test/workspace/barcode21/Hu_FAH05731_albacore202.chopped.barcode21.fastq


# convert the fastq to fasta

sed '/^@/!d;s//>/;N' ${BASEFOLDER}/workspace/${BARCODE}/${NAME}.chopped.${BARCODE}.fastq > ${BASEFOLDER}/workspace/${BARCODE}/${NAME}.chopped.${BARCODE}.fasta
+ sed '/^@/!d;s//>/;N' /home/yiheng/test/workspace/barcode21/Hu_FAH05731_albacore202.chopped.barcode21.fastq

# do blastn for the fasta file

blastn -query ${NAME}.chopped.${BARCODE}.fasta -db rg -evalue 0.01 -outfmt '6 qseqid sseqid evalue bitscore length pident nident sgi sacc staxids sscinames scomnames sskingdoms' -show_gis -num_threads 12 | sort -k1,1 -k4,4nr | sort -u -k1,1 --merge > ${NAME}_${BARCODE}_chopped.fasta.${DATE}.rgblast_output
+ sort -k1,1 -k4,4nr
+ blastn -query Hu_FAH05731_albacore202.chopped.barcode21.fasta -db rg -evalue 0.01 -outfmt '6 qseqid sseqid evalue bitscore length pident nident sgi sacc staxids sscinames scomnames sskingdoms' -show_gis -num_threads 12
+ sort -u -k1,1 --merge

### supplimentray information for format6:

### qseqid means Query Seq-id
### sseqid means Subject Seq-id
### evalue means Expect value
### bitscore means Bit score
### length means Alignment length
### pident means Percentage of identical matches
### nident means Number of identical matches
### sgi means Subject GI
### sacc means Subject accession
### staxids means Subject Taxonomy ID(s), separated by a ';'
### sscinames means Subject Scientific Name(s), separated by a ';'
### scomnames means Subject Common Name(s), separated by a ';'
### sskingdoms means Subject Super Kingdom(s), separated by a ';'

# cut the seqid from rgblast_output and write it into a list for separate the fasta hit files

cut -f 1 ${NAME}_${BARCODE}_chopped.fasta.${DATE}.rgblast_output > ${NAME}.rgblast.qseqid.${BARCODE}.txt
+ cut -f 1 Hu_FAH05731_albacore202_barcode21_chopped.fasta.20171025.rgblast_output

# separate the blast hit and nohit reads from the fasta file

filterbyname.sh in=${NAME}.chopped.${BARCODE}.fasta out=${NAME}.chopped.rghityes.${BARCODE}.fasta names=${NAME}.rgblast.qseqid.${BARCODE}.txt include=t
+ filterbyname.sh in=Hu_FAH05731_albacore202.chopped.barcode21.fasta out=Hu_FAH05731_albacore202.chopped.rghityes.barcode21.fasta names=Hu_FAH05731_albacore202.rgblast.qseqid.barcode21.txt include=t
java -ea -Xmx28428m -cp /home/yiheng/anaconda3/opt/bbmap-37.52/current/ driver.FilterReadsByName in=Hu_FAH05731_albacore202.chopped.barcode21.fasta out=Hu_FAH05731_albacore202.chopped.rghityes.barcode21.fasta names=Hu_FAH05731_albacore202.rgblast.qseqid.barcode21.txt include=t
Executing driver.FilterReadsByName [in=Hu_FAH05731_albacore202.chopped.barcode21.fasta, out=Hu_FAH05731_albacore202.chopped.rghityes.barcode21.fasta, names=Hu_FAH05731_albacore202.rgblast.qseqid.barcode21.txt, include=t]

Exception in thread "main" java.lang.AssertionError: File Hu_FAH05731_albacore202.chopped.rghityes.barcode21.fasta exists and overwrite=false
	at shared.Tools.testOutputFiles(Tools.java:564)
	at driver.FilterReadsByName.<init>(FilterReadsByName.java:235)
	at driver.FilterReadsByName.main(FilterReadsByName.java:40)
filterbyname.sh in=${NAME}.chopped.${BARCODE}.fasta out=${NAME}.chopped.rghitno.${BARCODE}.fasta names=${NAME}.rgblast.qseqid.${BARCODE}.txt include=f
+ filterbyname.sh in=Hu_FAH05731_albacore202.chopped.barcode21.fasta out=Hu_FAH05731_albacore202.chopped.rghitno.barcode21.fasta names=Hu_FAH05731_albacore202.rgblast.qseqid.barcode21.txt include=f
java -ea -Xmx28428m -cp /home/yiheng/anaconda3/opt/bbmap-37.52/current/ driver.FilterReadsByName in=Hu_FAH05731_albacore202.chopped.barcode21.fasta out=Hu_FAH05731_albacore202.chopped.rghitno.barcode21.fasta names=Hu_FAH05731_albacore202.rgblast.qseqid.barcode21.txt include=f
Executing driver.FilterReadsByName [in=Hu_FAH05731_albacore202.chopped.barcode21.fasta, out=Hu_FAH05731_albacore202.chopped.rghitno.barcode21.fasta, names=Hu_FAH05731_albacore202.rgblast.qseqid.barcode21.txt, include=f]

Exception in thread "main" java.lang.AssertionError: File Hu_FAH05731_albacore202.chopped.rghitno.barcode21.fasta exists and overwrite=false
	at shared.Tools.testOutputFiles(Tools.java:564)
	at driver.FilterReadsByName.<init>(FilterReadsByName.java:235)
	at driver.FilterReadsByName.main(FilterReadsByName.java:40)

# do the second blast for the rghitno fasta file

blastn -query ${NAME}.chopped.rghitno.${BARCODE}.fasta -db nt -evalue 0.01 -outfmt '6 qseqid sseqid evalue bitscore length pident nident sgi sacc staxids sscinames scomnames sskingdoms' -show_gis -num_threads 12 | sort -k1,1 -k4,4nr | sort -u -k1,1 --merge > ${NAME}_${BARCODE}_chopped.fasta.${DATE}.ntblast_output
+ sort -k1,1 -k4,4nr
+ blastn -query Hu_FAH05731_albacore202.chopped.rghitno.barcode21.fasta -db nt -evalue 0.01 -outfmt '6 qseqid sseqid evalue bitscore length pident nident sgi sacc staxids sscinames scomnames sskingdoms' -show_gis -num_threads 12
+ sort -u -k1,1 --merge
Command line argument error: Query is Empty!

# cut the seqid from the ntblast_output and write it into a list for separate the fasta hit files

cut -f 1 ${NAME}_${BARCODE}_chopped.fasta.${DATE}.ntblast_output > ${NAME}.ntblast.qseqid.${BARCODE}.txt
+ cut -f 1 Hu_FAH05731_albacore202_barcode21_chopped.fasta.20171025.ntblast_output

# separate the blast hit and nohit reads from the fasta file

filterbyname.sh in=${NAME}.chopped.rghitno.${BARCODE}.fasta out=${NAME}.chopped.rghitno.nthityes.${BARCODE}.fasta names=${NAME}.ntblast.qseqid.${BARCODE}.txt include=t
+ filterbyname.sh in=Hu_FAH05731_albacore202.chopped.rghitno.barcode21.fasta out=Hu_FAH05731_albacore202.chopped.rghitno.nthityes.barcode21.fasta names=Hu_FAH05731_albacore202.ntblast.qseqid.barcode21.txt include=t
java -ea -Xmx28428m -cp /home/yiheng/anaconda3/opt/bbmap-37.52/current/ driver.FilterReadsByName in=Hu_FAH05731_albacore202.chopped.rghitno.barcode21.fasta out=Hu_FAH05731_albacore202.chopped.rghitno.nthityes.barcode21.fasta names=Hu_FAH05731_albacore202.ntblast.qseqid.barcode21.txt include=t
Executing driver.FilterReadsByName [in=Hu_FAH05731_albacore202.chopped.rghitno.barcode21.fasta, out=Hu_FAH05731_albacore202.chopped.rghitno.nthityes.barcode21.fasta, names=Hu_FAH05731_albacore202.ntblast.qseqid.barcode21.txt, include=t]

Exception in thread "main" java.lang.AssertionError: File Hu_FAH05731_albacore202.chopped.rghitno.nthityes.barcode21.fasta exists and overwrite=false
	at shared.Tools.testOutputFiles(Tools.java:564)
	at driver.FilterReadsByName.<init>(FilterReadsByName.java:235)
	at driver.FilterReadsByName.main(FilterReadsByName.java:40)
filterbyname.sh in=${NAME}.chopped.rghitno.${BARCODE}.fasta out=${NAME}.chopped.rghitno.nthitno.${BARCODE}.fasta names=${NAME}.ntblast.qseqid.${BARCODE}.txt include=f
+ filterbyname.sh in=Hu_FAH05731_albacore202.chopped.rghitno.barcode21.fasta out=Hu_FAH05731_albacore202.chopped.rghitno.nthitno.barcode21.fasta names=Hu_FAH05731_albacore202.ntblast.qseqid.barcode21.txt include=f
java -ea -Xmx28428m -cp /home/yiheng/anaconda3/opt/bbmap-37.52/current/ driver.FilterReadsByName in=Hu_FAH05731_albacore202.chopped.rghitno.barcode21.fasta out=Hu_FAH05731_albacore202.chopped.rghitno.nthitno.barcode21.fasta names=Hu_FAH05731_albacore202.ntblast.qseqid.barcode21.txt include=f
Executing driver.FilterReadsByName [in=Hu_FAH05731_albacore202.chopped.rghitno.barcode21.fasta, out=Hu_FAH05731_albacore202.chopped.rghitno.nthitno.barcode21.fasta, names=Hu_FAH05731_albacore202.ntblast.qseqid.barcode21.txt, include=f]

Exception in thread "main" java.lang.AssertionError: File Hu_FAH05731_albacore202.chopped.rghitno.nthitno.barcode21.fasta exists and overwrite=false
	at shared.Tools.testOutputFiles(Tools.java:564)
	at driver.FilterReadsByName.<init>(FilterReadsByName.java:235)
	at driver.FilterReadsByName.main(FilterReadsByName.java:40)

